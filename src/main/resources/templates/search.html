<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>

  <link rel="stylesheet" href="css/site.css" />
  <style>
        /* Existing styles */
        .navbar-custom {
            background-color: #3498db;
        }

        .nav-link {
            color: #fff;
        }

        /* New styles to set text color in the table to black */
        .table th,
        .table td {
            color: black;
        }

        /* Custom style to reduce the width of the search input */
        .search-input {
            width: 1000px; /* Adjust the width as needed */
        }
    </style>

  <title>Check Flights</title>
</head>

<body>

<header>
  <nav class="navbar">
    <a class="logo" th:href="@{/home}">Flight Management System<span>.</span></a>
    <ul class="menu-links">
      <li><a th:href="@{/airline}">Airline</a></li>
      <li><a th:href="@{/flights}">Flight</a></li>
      <li><a th:href="@{/passenger}">Passenger</a></li>
      <li><a th:href="@{/clientBookings}">Bookings</a></li>
      <li><a th:href="@{/search}">Search Flights</a></li>
      <li><a th:href="@{/home}">Logout</a></li>
    </ul>
  </nav>
</header>

<div class="container">
  <form th:object="${flightsModel}" th:action="@{/search}" method="get">

    <!-- Radio buttons for selecting search type -->
    <label>Search Type:</label>
    <input type="radio" id="flightIdRadio" name="searchType" value="flightId" th:attr="checked=${searchType == 'flightId'}">
    <label for="flightIdRadio">Search by Flight ID</label>
    <input type="radio" id="originDestRadio" name="searchType" value="originDest" th:attr="checked=${searchType == 'originDest'}">
    <label for="originDestRadio">Search by Origin and Destination</label>

    <!-- Use the datalist for suggestions -->
    <input type="search" name="flightId" id="flightIdInput" required list="flightIds"
           oninput="getSuggestions(this.value)" class="search-input">

    <!-- New input fields for searching by origin and destination -->
    <label th:if="${searchType == 'originDest'}" for="originInput">Origin:</label>
    <input th:if="${searchType == 'originDest'}" type="search" name="origin" id="originInput" list="originList">

    <label th:if="${searchType == 'originDest'}" for="destinationInput">Destination:</label>
    <input th:if="${searchType == 'originDest'}" type="search" name="destination" id="destinationInput" list="destinationList">


    <datalist id="flightIds">
      <!-- Iterate over suggestedMilitaryNumbers to provide suggestions -->
      <option th:each="text : ${suggestedflightIds}" th:value="${text}" />
    </datalist>

    <!-- Datalist for origin suggestions -->
    <datalist id="originList">
      <!-- Iterate over suggestedOrigins to provide suggestions -->
      <option th:each="text : ${suggestedOrigins}" th:value="${text}" />
    </datalist>

    <!-- Datalist for destination suggestions -->
    <datalist id="destinationList">
      <!-- Iterate over suggestedDestinations to provide suggestions -->
      <option th:each="text : ${suggestedDestinations}" th:value="${text}" />
    </datalist>

    <br />
    <br />
    <div class="form-group submit-btn">
      <input type="submit" value="Search">
    </div>

    <div class="form-group submit-btn" th:if="${flightFound == null or not flightFound}">
      <p>No Flight found.</p>
    </div>
  </form>

  <div th:if="${flightFound}" class="table">
    <h1 style="font-size:40px;"><strong>Flights Information</strong></h1>
    <table class="table">
      <!-- Display Flights details -->
      <tr>
        <th scope="col">Flight Id</th>
        <th scope="col">Airline</th>
        <th scope="col">Origin</th>
        <th scope="col">Destination</th>
        <th scope="col">Departure Time</th>
        <th scope="col">Arrival Time</th>
        <th scope="col">Available Seats</th>
        <th scope="col">Ticket Price</th>
      </tr>
      <tr>
        <td th:text="${flight.flightId}"></td>
        <td th:text="${flight.airlineId.name}"></td>
        <td th:text="${flight.origin}"></td>
        <td th:text="${flight.destination}"></td>
        <td th:text="${flight.departureTime}"></td>
        <td th:text="${flight.arrivalTime}"></td>
        <td th:text="${flight.availableSeats}"></td>
        <td th:text="${flight.ticketPrice}"></td>
      </tr>
    </table>

    <div>
      <button onclick="downloadExcel()">Download</button>
      <!--<button onclick="downloadPDF()">Download as PDF</button>-->
    </div>
  </div>
</div>

<script>
    function getSuggestions(value) {
        // Implement your suggestion logic here
    }

    function deleteFlight(id) {
        if (confirm("Are you sure you want to delete this airline?")) {
            // Use AJAX to send a DELETE request
            $.ajax({
                type: "DELETE",
                url: "/deleteAirline/" + id,
                success: function () {
                    // Refresh the table after successful deletion
                    location.reload();
                },
                error: function () {
                    alert("Error deleting the airline.");
                }
            });
        }
    }

    function downloadPDF() {
        var pdf = new jsPDF();
        pdf.autoTable({ html: '.table' });
        pdf.save('flights.pdf');
    }

    function downloadExcel() {
        /* Select the table element */
        var table = document.querySelector('.table');

        /* Convert table to Excel */
        var ws = XLSX.utils.table_to_sheet(table);

        /* Create a workbook with a single sheet */
        var wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');

        /* Save the workbook as an Excel file */
        XLSX.writeFile(wb, 'flights.xlsx');
    }
</script>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

</body>

</html>
